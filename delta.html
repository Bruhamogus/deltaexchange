<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delta Swap</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.umd.min.js"></script>
</head>
<body>
    <h2>Swap DELTA for ETH</h2>
    <input type="number" id="amount" placeholder="Amount in DELTA">
    <button id="connectWallet">Connect Wallet</button>
    <button id="swapTokens">Swap</button>
    <p id="balance">Balance: </p>

    <script>
        const DELTA_ADDRESS = "0x9ed933f2241135AE6b37e5Ad3EbD6D2a4D989fec";
        const DELTA_ABI = [
            "function approve(address spender, uint256 amount) public returns (bool)",
            "function balanceOf(address owner) view returns (uint256)",
            "function transferFrom(address sender, address recipient, uint256 amount) public returns (bool)"
        ];
        
        let provider;
        let signer;
        let account;

        async function connectWallet() {
            if (!window.ethereum) {
                alert("MetaMask not found. Please install MetaMask.");
                return;
            }
            try {
                provider = new ethers.providers.Web3Provider(window.ethereum);
                const accounts = await provider.send("eth_requestAccounts", []);
                signer = provider.getSigner();
                account = accounts[0];
                document.getElementById("connectWallet").innerText = `Connected: ${account.substring(0, 6)}...${account.slice(-4)}`;
                updateBalance();
            } catch (error) {
                alert("Connection failed: " + error.message);
            }
        }

        async function updateBalance() {
            if (!provider || !account) return;
            const deltaContract = new ethers.Contract(DELTA_ADDRESS, DELTA_ABI, provider);
            const balance = await deltaContract.balanceOf(account);
            document.getElementById("balance").innerText = `Balance: ${ethers.utils.formatUnits(balance, 18)} DELTA`;
        }

        async function swapTokens() {
            if (!provider || !account) return;
            const deltaContract = new ethers.Contract(DELTA_ADDRESS, DELTA_ABI, signer);
            const amount = document.getElementById("amount").value;
            const amountInWei = ethers.utils.parseUnits(amount, 18);
            await deltaContract.approve(account, amountInWei);
            await deltaContract.transferFrom(account, "swap_contract_address", amountInWei);
            alert("Swap successful!");
            updateBalance();
        }

        document.getElementById("connectWallet").addEventListener("click", connectWallet);
        document.getElementById("swapTokens").addEventListener("click", swapTokens);
    </script>
</body>
</html>
